<!DOCTYPE html>
<html lang="ko">

<head th:replace="fragment/config.html"></head>

<body>
	<main class="d-flex w-100">
		<div class="container d-flex flex-column">
			<div class="row vh-100">
				<div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
					<div class="d-table-cell align-middle">

						<div class="text-center mt-4">
							<h1 class="h2">회원 가입</h1>
						</div>

						<div class="card">
							<div class="card-body">
								<div class="m-sm-4">
									<form th:action th:object="${customer}" th:method="post">

										<div th:if="${#fields.hasGlobalErrors()}">
											<p class="text-danger" th:each="err : ${#fields.globalErrors()}"
											   th:text="${err}">글로벌 오류 메시지</p>
										</div>
										<div th:if="${regFail}">
											<p class="text-danger" th:text="${regFail}">카카오 계정 연동 오류</p>
										</div>

										<div class="mb-3">
											<label class="form-label">로그인 ID</label>
											<input class="form-control form-control-lg" type="text" id="loginId" th:field="*{loginId}" th:errorclass="field-error" />
											<button class="btn btn-outline-dark" type="button" onclick="dupLoginIdFun(document.getElementById('loginId').value)">아이디 중복 확인</button>
											<div class="field-error text-danger" th:errors="*{loginId}">
												아이디 오류
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">비밀번호</label>
											<input class="form-control form-control-lg" type="password"id="password" th:field="*{password}"  th:errorclass="field-error" />
											<div class="field-error text-danger" th:errors="*{password}">
												비밀번호 오류
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">비밀번호 확인</label>
											<input class="form-control form-control-lg" type="password"id="passwordCheck" th:field="*{passwordCheck}"  th:errorclass="field-error" />
											<div class="field-error text-danger" th:errors="*{passwordCheck}">
												비밀번호 확인 오류
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">이름</label>
											<input class="form-control form-control-lg" type="text"id="name" th:field="*{name}"  th:errorclass="field-error" />
											<div class="field-error text-danger" th:errors="*{name}">
												이름 오류
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">나이</label>
											<input class="form-control form-control-lg" type="text" id="age" th:field="*{age}"  th:errorclass="field-error" />
											<div class="field-error text-danger" th:errors="*{age}">
												나이 오류
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">이메일</label>
											<input class="form-control form-control-lg" type="email" id="email" th:field="*{email}"  th:errorclass="field-error" />
											<div class="field-error text-danger" th:errors="*{email}">
												나이 오류
											</div>
										</div>
										<div th:if="${isKakao == true}">
											<div class="text-success">카카오톡 계정 연동 완료!</div>
											<input type="hidden" name="kakaoId" th:value="${kakaoId}"></input>
										</div><br>
										<div th:if="${dupKakao == true}">
											<div class="text-danger">이미 등록된 카카오톡 계정입니다.</div>
										</div>
										<div class="text-center mt-3">
											<button class="btn btn-lg btn-primary" type="button" th:onclick="|location.href='@{/kakao/register}'|">카카오 계정 연결</button>
											<button type="submit" class="btn btn-lg btn-primary" >회원가입</button>
											<button class="btn btn-lg btn-primary" type="button" th:onclick="|location.href='@{/}'|">취소</button>
										</div>
									</form>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</main>

	<script src="../../js/app.js"></script>
	<script th:inline="javascript">
		var dupLoginIdURL = "http://localhost:8080/api/dup-id"
		function dupLoginIdFun(inputLoginId) {

			fetch(dupLoginIdURL, {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({
					loginId : inputLoginId,
				}),
			}).then((response) => {
				if (response.status === 400) {
					alert("중복된 아이디입니다!");
					return false;
				}else{
					alert("가입 가능한 아이디입니다!");
					return true;
				}});

		};

	</script>

</body>

</html>